<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>OpenRouter Chat</title>
  <link rel="stylesheet" href="/static/styles.css" />
</head>

<body>
  <header>
    <h1>Ziggazigah</h1>
  </header>

  <main>
    <section class="controls">
      <button id="model-explorer-button" type="button" class="ghost-button">Model explorer</button>
      <label class="visually-hidden" for="model-select">Model</label>
      <select id="model-select" autocomplete="off">
        <option value="openrouter/auto">Loading models…</option>
      </select>
      <button id="clear-chat" type="button">Clear chat</button>
      <button id="toggle-web-search" type="button" class="ghost-button" aria-pressed="false">
        Web search off
      </button>
      <button id="open-settings" type="button" class="ghost-button">Model settings</button>
      <button id="open-speech-settings" type="button" class="ghost-button">Speech settings</button>
    </section>

    <section id="chat-log" aria-live="polite"></section>

    <form id="chat-form">
      <label class="visually-hidden" for="message-input">Message</label>
      <div class="chat-input">
        <textarea id="message-input" placeholder="Send a message to the selected model…" rows="3" required></textarea>
        <button id="voice-button" type="button" class="icon-button" aria-label="Start voice input">
          <img src="/static/icons/mic_24dp_E3E3E3_FILL0_wght400_GRAD0_opsz24.svg" alt="" width="24" height="24" />
        </button>
        <button id="stop-button" type="button" class="ghost-button" hidden>Stop</button>
      </div>
    </form>
  </main>


  <div id="model-settings-modal" class="modal" aria-hidden="true">
    <div class="modal__backdrop" id="model-settings-backdrop" data-close-settings></div>
    <div class="modal__dialog" role="dialog" aria-modal="true" aria-labelledby="model-settings-title">
      <form id="model-settings-form" class="settings-card model-settings-form">
        <header class="section-header modal__header">
          <div>
            <h2 id="model-settings-title">Active Model Settings</h2>
            <p class="section-subtitle">Control the default model, routing strategy, and hyperparameters.</p>
          </div>
          <div class="modal__header-actions">
            <p id="settings-updated-at" class="settings-meta" hidden></p>
            <button type="button" id="close-settings" class="icon-button" aria-label="Close model settings"
              data-close-settings>
              <span aria-hidden="true">×</span>
            </button>
          </div>
        </header>

        <div class="modal__body">
          <div class="form-group">
            <span class="field-label">Active model</span>
            <p id="active-model-display" class="field-display"></p>
            <details id="model-description-details" class="model-description" hidden>
              <summary class="model-description-summary">Description</summary>
              <div id="model-description-content" class="model-description-content"></div>
            </details>
            <p class="field-hint">Settings apply to the model currently selected in chat.</p>
          </div>

          <fieldset class="form-fieldset">
            <legend>Provider Routing</legend>
            <div class="form-grid two-column">
              <label class="field-group">
                <span class="field-label" for="provider-sort">Sort strategy</span>
                <select id="provider-sort">
                  <option value="">Auto (balanced)</option>
                  <option value="price">Price</option>
                  <option value="throughput">Throughput</option>
                  <option value="latency">Latency</option>
                </select>
              </label>
              <label class="field-group">
                <span class="field-label" for="provider-data-collection">Data collection</span>
                <select id="provider-data-collection">
                  <option value="">Allow (default)</option>
                  <option value="deny">Deny</option>
                </select>
                <p class="field-hint">Require zero data retention providers when set to deny.</p>
              </label>
              <label class="field-group">
                <span class="field-label" for="provider-allow-fallbacks">Allow fallbacks</span>
                <select id="provider-allow-fallbacks">
                  <option value="">Use provider default</option>
                  <option value="true">Allow fallback providers</option>
                  <option value="false">Disallow fallbacks</option>
                </select>
              </label>
              <label class="field-group">
                <span class="field-label" for="provider-require-parameters">Require parameters</span>
                <select id="provider-require-parameters">
                  <option value="">Use provider default</option>
                  <option value="true">Only providers supporting all parameters</option>
                  <option value="false">Best effort</option>
                </select>
              </label>
            </div>
          </fieldset>

          <fieldset class="form-fieldset">
            <legend>
              <span>Hyperparameters</span>
              <button type="button" id="reset-hyperparameters" class="legend-action">Use defaults</button>
            </legend>
            <div class="form-grid three-column">
              <div class="field-group slider-field" data-slider-field="param-temperature">
                <label class="field-label" for="param-temperature">Temperature</label>
                <div class="range-control">
                  <div class="range-row">
                    <input id="param-temperature" class="slider-input" type="range" min="0" max="2" step="0.01"
                      data-default-value="1" />
                    <output class="range-output" data-slider-value="param-temperature" aria-live="polite"></output>
                  </div>
                </div>
              </div>
              <div class="field-group slider-field" data-slider-field="param-top-p">
                <label class="field-label" for="param-top-p">Top P</label>
                <div class="range-control">
                  <div class="range-row">
                    <input id="param-top-p" class="slider-input" type="range" min="0" max="1" step="0.01"
                      data-default-value="1" />
                    <output class="range-output" data-slider-value="param-top-p" aria-live="polite"></output>
                  </div>
                </div>
              </div>
              <div class="field-group slider-field" data-slider-field="param-top-k">
                <label class="field-label" for="param-top-k">Top K</label>
                <div class="range-control">
                  <div class="range-row">
                    <input id="param-top-k" class="slider-input" type="range" min="0" max="400" step="1"
                      data-default-value="0" />
                    <output class="range-output" data-slider-value="param-top-k" aria-live="polite"></output>
                  </div>
                </div>
              </div>
              <div class="field-group slider-field" data-slider-field="param-min-p">
                <label class="field-label" for="param-min-p">Min P</label>
                <div class="range-control">
                  <div class="range-row">
                    <input id="param-min-p" class="slider-input" type="range" min="0" max="1" step="0.01"
                      data-default-value="0" />
                    <output class="range-output" data-slider-value="param-min-p" aria-live="polite"></output>
                  </div>
                </div>
              </div>
              <div class="field-group slider-field" data-slider-field="param-top-a">
                <label class="field-label" for="param-top-a">Top A</label>
                <div class="range-control">
                  <div class="range-row">
                    <input id="param-top-a" class="slider-input" type="range" min="0" max="1" step="0.01"
                      data-default-value="0" />
                    <output class="range-output" data-slider-value="param-top-a" aria-live="polite"></output>
                  </div>
                </div>
              </div>
              <div class="field-group slider-field" data-slider-field="param-max-tokens">
                <label class="field-label" for="param-max-tokens">Max tokens</label>
                <div class="range-control">
                  <div class="range-row">
                    <input id="param-max-tokens" class="slider-input" type="range" min="0" max="32000" step="1"
                      data-default-value="0" />
                    <output class="range-output" data-slider-value="param-max-tokens" aria-live="polite"></output>
                  </div>
                </div>
              </div>
              <div class="field-group slider-field" data-slider-field="param-frequency-penalty">
                <label class="field-label" for="param-frequency-penalty">Frequency penalty</label>
                <div class="range-control">
                  <div class="range-row">
                    <input id="param-frequency-penalty" class="slider-input" type="range" min="-2" max="2" step="0.01"
                      data-default-value="0" />
                    <output class="range-output" data-slider-value="param-frequency-penalty"
                      aria-live="polite"></output>
                  </div>
                </div>
              </div>
              <div class="field-group slider-field" data-slider-field="param-presence-penalty">
                <label class="field-label" for="param-presence-penalty">Presence penalty</label>
                <div class="range-control">
                  <div class="range-row">
                    <input id="param-presence-penalty" class="slider-input" type="range" min="-2" max="2" step="0.01"
                      data-default-value="0" />
                    <output class="range-output" data-slider-value="param-presence-penalty" aria-live="polite"></output>
                  </div>
                </div>
              </div>
              <div class="field-group slider-field" data-slider-field="param-repetition-penalty">
                <label class="field-label" for="param-repetition-penalty">Repetition penalty</label>
                <div class="range-control">
                  <div class="range-row">
                    <input id="param-repetition-penalty" class="slider-input" type="range" min="0" max="2" step="0.01"
                      data-default-value="1" />
                    <output class="range-output" data-slider-value="param-repetition-penalty"
                      aria-live="polite"></output>
                  </div>
                </div>
              </div>
              <div class="field-group slider-field" data-slider-field="param-seed">
                <label class="field-label" for="param-seed">Seed</label>
                <div class="range-control">
                  <div class="range-row">
                    <input id="param-seed" class="slider-input" type="range" min="0" max="1000000" step="1"
                      data-default-value="0" />
                    <output class="range-output" data-slider-value="param-seed" aria-live="polite"></output>
                  </div>
                </div>
              </div>
              <label class="field-group">
                <span class="field-label" for="param-parallel-tool-calls">Parallel tool calls</span>
                <select id="param-parallel-tool-calls">
                  <option value="">Use provider default</option>
                  <option value="true">Enable</option>
                  <option value="false">Disable</option>
                </select>
              </label>
              <label class="field-group">
                <span class="field-label" for="param-tool-choice">Tool choice</span>
                <select id="param-tool-choice">
                  <option value="">Use provider default</option>
                  <option value="auto">Auto (model decides)</option>
                  <option value="none">None (disable tools)</option>
                  <option value="required">Required (force tool use)</option>
                </select>
              </label>
              <label class="field-group">
                <span class="field-label" for="param-safe-prompt">Safe prompt</span>
                <select id="param-safe-prompt">
                  <option value="">Use provider default</option>
                  <option value="true">Enable</option>
                  <option value="false">Disable</option>
                </select>
              </label>
              <label class="field-group">
                <span class="field-label" for="param-raw-mode">Raw mode</span>
                <select id="param-raw-mode">
                  <option value="">Use provider default</option>
                  <option value="true">Enable</option>
                  <option value="false">Disable</option>
                </select>
              </label>
              <label class="field-group">
                <span class="field-label" for="param-structured-outputs">Structured outputs</span>
                <select id="param-structured-outputs">
                  <option value="">Use provider default</option>
                  <option value="true">Enable</option>
                  <option value="false">Disable</option>
                </select>
              </label>
              <label class="field-group">
                <span class="field-label" for="param-response-format">Response format</span>
                <select id="param-response-format">
                  <option value="">Default (text)</option>
                  <option value="json_object">JSON Object</option>
                  <option value="json_schema">JSON Schema</option>
                </select>
              </label>
            </div>
            <fieldset class="form-fieldset">
              <legend>Reasoning (for thinking models)</legend>
              <div class="form-grid three-column">
                <label class="field-group">
                  <span class="field-label" for="param-reasoning-effort">Reasoning effort</span>
                  <select id="param-reasoning-effort">
                    <option value="">Default</option>
                    <option value="low">Low</option>
                    <option value="medium">Medium</option>
                    <option value="high">High</option>
                  </select>
                </label>
                <div class="field-group slider-field" data-slider-field="param-reasoning-max-tokens">
                  <label class="field-label" for="param-reasoning-max-tokens">Reasoning max tokens</label>
                  <div class="range-control">
                    <div class="range-row">
                      <input id="param-reasoning-max-tokens" class="slider-input" type="range" min="0" max="10000"
                        step="100" data-default-value="0" />
                      <output class="range-output" data-slider-value="param-reasoning-max-tokens"
                        aria-live="polite"></output>
                    </div>
                  </div>
                </div>
                <label class="field-group">
                  <span class="field-label" for="param-reasoning-exclude">Exclude reasoning from output</span>
                  <select id="param-reasoning-exclude">
                    <option value="">Use provider default</option>
                    <option value="true">Exclude reasoning</option>
                    <option value="false">Include reasoning</option>
                  </select>
                </label>
              </div>
            </fieldset>
            <label class="field-group full-span">
              <span class="field-label" for="param-stop">Stop sequences</span>
              <textarea id="param-stop" rows="3" placeholder="One sequence per line or comma-separated"></textarea>
            </label>
          </fieldset>
        </div>

        <footer class="form-actions modal__footer">
          <button type="submit" id="settings-submit">Save settings</button>
          <span id="settings-status" class="settings-status" role="status" aria-live="polite"></span>
        </footer>
      </form>
    </div>
  </div>

  <div id="speech-settings-modal" class="modal" aria-hidden="true">
    <div class="modal__backdrop" id="speech-settings-backdrop" data-close-speech-settings></div>
    <div class="modal__dialog" role="dialog" aria-modal="true" aria-labelledby="speech-settings-title">
      <form id="speech-settings-form" class="settings-card speech-settings-form">
        <header class="section-header modal__header">
          <div>
            <h2 id="speech-settings-title">Speech Settings</h2>
            <p class="section-subtitle">Configure STT, TTS, and Wakeword behavior for voice features.</p>
          </div>
          <div class="modal__header-actions">
            <p id="speech-settings-updated-at" class="settings-meta" hidden></p>
            <button type="button" id="close-speech-settings" class="icon-button" aria-label="Close speech settings"
              data-close-speech-settings>
              <span aria-hidden="true">×</span>
            </button>
          </div>
        </header>

        <div class="modal__body">
          <fieldset class="form-fieldset">
            <legend>Speech-to-Text (STT)</legend>
            <div class="form-grid two-column">
              <label class="field-group">
                <span class="field-label" for="stt-provider">Provider</span>
                <select id="stt-provider">
                  <option value="deepgram">Deepgram</option>
                </select>
              </label>
              <label class="field-group">
                <span class="field-label" for="stt-model">Model</span>
                <select id="stt-model">
                  <option value="nova-3">nova-3</option>
                  <option value="nova-2">nova-2</option>
                </select>
              </label>
              <label class="field-group">
                <span class="field-label" for="stt-interim">Interim results</span>
                <select id="stt-interim">
                  <option value="true">Enable</option>
                  <option value="false">Disable</option>
                </select>
              </label>
              <label class="field-group">
                <span class="field-label" for="stt-vad-events">VAD events</span>
                <select id="stt-vad-events">
                  <option value="true">Enable</option>
                  <option value="false">Disable</option>
                </select>
              </label>
              <label class="field-group">
                <span class="field-label" for="stt-utterance-end-ms">Utterance end (ms)</span>
                <input id="stt-utterance-end-ms" type="number" min="0" step="100" value="1000" />
              </label>
              <label class="field-group">
                <span class="field-label" for="stt-endpointing">Endpointing (ms)</span>
                <input id="stt-endpointing" type="number" min="0" step="100" value="1000" />
              </label>
              <label class="field-group">
                <span class="field-label" for="stt-auto-submit">Auto-submit on speech end</span>
                <select id="stt-auto-submit">
                  <option value="true">Enable</option>
                  <option value="false">Disable</option>
                </select>
              </label>
              <label class="field-group">
                <span class="field-label" for="stt-timeout-ms">Listening timeout (ms)</span>
                <input id="stt-timeout-ms" type="number" min="5000" max="300000" step="500" value="5000"
                  placeholder="5000" title="Timeout in milliseconds (5-300 seconds, adjustable in 500ms increments)" />
              </label>
            </div>
          </fieldset>

          <fieldset class="form-fieldset">
            <legend>Text-to-Speech (TTS)</legend>
            <div class="form-grid two-column">
              <label class="field-group">
                <span class="field-label" for="tts-provider">Provider</span>
                <select id="tts-provider">
                  <option value="">None</option>
                  <option value="elevenlabs">ElevenLabs</option>
                  <option value="openai">OpenAI</option>
                </select>
              </label>
              <label class="field-group">
                <span class="field-label" for="tts-voice">Voice</span>
                <input id="tts-voice" type="text" placeholder="e.g., 'Alloy', 'Rachel'" />
              </label>
            </div>
          </fieldset>

          <fieldset class="form-fieldset">
            <legend>Wakeword</legend>
            <div class="form-grid two-column">
              <label class="field-group">
                <span class="field-label" for="wakeword-enabled">Wakeword enabled</span>
                <select id="wakeword-enabled">
                  <option value="false">Disabled</option>
                  <option value="true">Enabled</option>
                </select>
              </label>
              <label class="field-group">
                <span class="field-label" for="wakeword-phrase">Wakeword phrase</span>
                <input id="wakeword-phrase" type="text" placeholder="e.g., 'computer'" />
              </label>
            </div>
          </fieldset>

          <fieldset class="form-fieldset">
            <legend>Conversation Mode</legend>
            <div class="form-grid two-column">
              <label class="field-group">
                <span class="field-label" for="conversation-enabled">Conversation mode</span>
                <select id="conversation-enabled">
                  <option value="false">Disabled (manual activation only)</option>
                  <option value="true">Enabled (auto-restart listening after AI response)</option>
                </select>
              </label>
            </div>
          </fieldset>
        </div>

        <footer class="form-actions modal__footer">
          <button type="submit" id="speech-settings-submit">Save settings</button>
          <span id="speech-settings-status" class="settings-status" role="status" aria-live="polite"></span>
        </footer>
      </form>
    </div>
  </div>


  <template id="message-template">
    <article class="message">
      <div class="meta">
        <span class="meta__label"></span>
        <button type="button" class="metadata-button" hidden>Usage</button>
      </div>
      <details class="reasoning" hidden>
        <summary class="reasoning__summary">Reasoning</summary>
        <div class="reasoning__content"></div>
      </details>
      <div class="content"></div>
    </article>
  </template>

  <div id="message-metadata-modal" class="modal" aria-hidden="true">
    <div class="modal__backdrop" id="message-metadata-backdrop" data-close-metadata></div>
    <div class="modal__dialog" role="dialog" aria-modal="true" aria-labelledby="message-metadata-title">
      <div class="settings-card metadata-card">
        <header class="section-header modal__header">
          <div>
            <h2 id="message-metadata-title">Usage Details</h2>
            <p class="section-subtitle">Token counts, cost, and caching breakdown for the last reply.</p>
          </div>
          <div class="modal__header-actions">
            <button type="button" id="close-message-metadata" class="icon-button" aria-label="Close usage details"
              data-close-metadata>
              <span aria-hidden="true">×</span>
            </button>
          </div>
        </header>
        <div class="modal__body">
          <div id="message-metadata-content" class="metadata-list"></div>
        </div>
      </div>
    </div>
  </div>

  <script src="/static/main.js" type="module"></script>
</body>

</html>
